<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <title>å›½é£åœ£è¯ç¥ç¦ ğŸ„</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <style>
        body {
            margin: 0;
            overflow: hidden;
            background: radial-gradient(circle at top, #2b3a4a, #000);
            font-family: "Microsoft YaHei", sans-serif;
        }

        /* UI */
        #ui {
            position: absolute;
            top: 18px;
            width: 100%;
            text-align: center;
            z-index: 10;
            pointer-events: none;
        }

        #name {
            font-size: 36px;
            color: #ffd6e8;
            text-shadow: 0 0 14px rgba(255, 180, 220, .9);
        }

        #blessing {
            margin-top: 12px;
            font-size: 20px;
            color: #e6f7ff;
            min-height: 60px;
            line-height: 1.6;
            text-shadow: 0 0 12px rgba(120, 200, 255, .9);
        }

        /* å¼¹çª— */
        .popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(.6);
            opacity: 0;
            padding: 26px 30px;
            border-radius: 20px;
            background: rgba(255, 255, 255, .15);
            backdrop-filter: blur(12px);
            color: #fff;
            text-align: center;
            z-index: 30;
            transition: .35s cubic-bezier(.4, 0, .2, 1);
        }

        .popup.show {
            opacity: 1;
            transform: translate(-50%, -50%) scale(1);
        }

        .popup h2 {
            margin: 0 0 10px;
            color: #ffd6e8;
        }

        .popup button {
            margin-top: 12px;
            padding: 6px 16px;
            border: none;
            border-radius: 12px;
            background: #ffb6d5;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <div id="ui">
        <div id="name">ğŸ„ å››å–œupupğŸ‘‘å€’å¤´ğŸ‘‘æ—©é¥­ğŸ„</div>
        <div id="blessing"></div>
    </div>

    <!-- éŸ³ä¹ -->
    <audio id="bgm" loop>
        <source src="music.mp3" type="audio/mpeg">
    </audio>

    <div class="popup" id="popup">
        <h2 id="popupTitle"></h2>
        <p id="popupText"></p>
        <button onclick="closePopup()">å…³é—­</button>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/three@0.152.2/build/three.min.js"></script>

    <script>
        /* åœºæ™¯ */
        const scene = new THREE.Scene();
        scene.fog = new THREE.Fog(0x000000, 25, 70);

        const camera = new THREE.PerspectiveCamera(60, innerWidth / innerHeight, .1, 200);
        camera.position.set(0, 10, 32);

        const renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
        renderer.setSize(innerWidth, innerHeight);
        renderer.setPixelRatio(devicePixelRatio);
        document.body.appendChild(renderer.domElement);

        /* ç¯å…‰ */
        scene.add(new THREE.AmbientLight(0xffffff, .9));
        const mainLight = new THREE.DirectionalLight(0xfff2e5, 1.2);
        mainLight.position.set(-10, 30, 20);
        scene.add(mainLight);

        /* ===== åœ£è¯æ ‘ï¼ˆä¸ç§»åŠ¨ã€ä¸ç¼©æ”¾ï¼‰ ===== */
        const tree = new THREE.Group();

        function leaf(radius, y) {
            const pts = [];
            for (let i = 0; i < 18; i++) {
                pts.push(new THREE.Vector2(radius * (.8 + Math.random() * .4), i * .18));
            }
            const geo = new THREE.LatheGeometry(pts, 48);
            const mat = new THREE.MeshStandardMaterial({
                color: 0x7fd8b5,
                transparent: true,
                opacity: .95,
                emissive: 0xffc0d8,
                emissiveIntensity: .15
            });
            const m = new THREE.Mesh(geo, mat);
            m.position.y = y;
            return m;
        }
        for (let i = 0; i < 9; i++) {
            tree.add(leaf(8 - i * .8, i * 1.9));
        }

        const trunk = new THREE.Mesh(
            new THREE.CylinderGeometry(1, 1.4, 4),
            new THREE.MeshStandardMaterial({ color: 0x5b3a1a })
        );
        trunk.position.y = -3;
        tree.add(trunk);

        /* â­ æ˜Ÿæ˜Ÿå‘¼å¸ */
        const star = new THREE.Mesh(
            new THREE.OctahedronGeometry(1.4),
            new THREE.MeshStandardMaterial({
                color: 0xfff2aa,
                emissive: 0xffd966,
                emissiveIntensity: 1
            })
        );
        star.position.y = 20;
        tree.add(star);

        /* å½©ç¯ï¼ˆæ•´ç»„å˜è‰²ï¼‰ */
        const lights = [];
        for (let i = 0; i < 90; i++) {
            const bulb = new THREE.Mesh(
                new THREE.SphereGeometry(.18, 12, 12),
                new THREE.MeshStandardMaterial({ emissiveIntensity: 1 })
            );
            const a = i * .35;
            bulb.position.set(
                Math.cos(a) * (6 - i * .05),
                i * .22,
                Math.sin(a) * (6 - i * .05)
            );
            tree.add(bulb);
            lights.push(bulb);
        }
        scene.add(tree);

        const lightColors = [
            new THREE.Color(0xff4d4d),
            new THREE.Color(0xffe066),
            new THREE.Color(0xffffff),
            new THREE.Color(0xffb6d5),
            new THREE.Color(0x9ad9ff),
            new THREE.Color(0xc8a2ff)
        ];

        /* ===== ç¤¼ç‰©ï¼ˆåŠ  ribbonï¼‰ ===== */
        const gifts = [];
        const giftTexts = [
            "æ„¿ä½ è¢«æ¸©æŸ”ä»¥å¾… ğŸ€",
            "æ„¿å¿«ä¹å¦‚é›ªé™ä¸´ â„",
            "æ„¿æ¢¦æƒ³æ…¢æ…¢ç»½æ”¾ âœ¨",
            "æ„¿ç”Ÿæ´»å¤„å¤„æœ‰å…‰ ğŸŒ¸",
            "æ„¿æ–°ä¸€å¹´é—ªé—ªå‘å…‰ ğŸ"
        ];

        for (let i = 0; i < 5; i++) {
            const box = new THREE.Group();

            const base = new THREE.Mesh(
                new THREE.BoxGeometry(2, 2, 2),
                new THREE.MeshStandardMaterial({ color: lightColors[i] })
            );
            box.add(base);

            // ğŸ€ ribbonï¼ˆåå­—ï¼‰
            const ribbonMat = new THREE.MeshStandardMaterial({ color: 0xffffff });
            box.add(new THREE.Mesh(new THREE.BoxGeometry(.3, 2.1, 2.1), ribbonMat));
            box.add(new THREE.Mesh(new THREE.BoxGeometry(2.1, 2.1, .3), ribbonMat));

            // ğŸ€ è´è¶ç»“
            const bow = new THREE.Mesh(
                new THREE.TorusGeometry(.35, .12, 12, 24),
                new THREE.MeshStandardMaterial({ color: 0xffe0f0 })
            );
            bow.position.y = 1.2;
            bow.rotation.x = Math.PI / 2;
            box.add(bow);

            box.position.set((i - 2) * 3, -6, 4);
            box.userData.text = giftTexts[i];

            scene.add(box);
            gifts.push(box);
        }

        /* ä¸‹é›ª */
        const snowGeo = new THREE.BufferGeometry();
        const snow = [];
        for (let i = 0; i < 1400; i++) {
            snow.push((Math.random() - .5) * 90, Math.random() * 60, (Math.random() - .5) * 90);
        }
        snowGeo.setAttribute("position", new THREE.Float32BufferAttribute(snow, 3));
        const snowObj = new THREE.Points(
            snowGeo,
            new THREE.PointsMaterial({ color: 0xffffff, size: .4, opacity: .8, transparent: true })
        );
        scene.add(snowObj);

        /* âœï¸ ç¥ç¦æ–‡å­—ï¼ˆåªä¿ç•™ä½ æŒ‡å®šçš„ä¸¤è¡Œï¼‰ */
        const text =
            "æ„¿è¿™ä¸ªåœ£è¯ï¼Œç¯ç«æ¸©æŸ”ï¼Œ\n" +
            "é›ªè½äººé—´ï¼Œä¸‡ç‰©å®‰ç„¶ã€‚ğŸ„âœ¨\n";

        let ti = 0;
        const boxText = document.getElementById("blessing");
        (function type() {
            if (ti < text.length) {
                boxText.innerHTML += text[ti] == "\n" ? "<br>" : text[ti];
                ti++;
                setTimeout(type, 90);
            }
        })();

        /* ç‚¹å‡» */
        const ray = new THREE.Raycaster();
        const mouse = new THREE.Vector2();
        window.addEventListener("click", e => {
            document.getElementById("bgm").play();

            mouse.x = e.clientX / innerWidth * 2 - 1;
            mouse.y = -(e.clientY / innerHeight) * 2 + 1;
            ray.setFromCamera(mouse, camera);

            const hit = ray.intersectObjects(gifts, true);
            if (hit.length) {
                popupTitle.innerText = "ğŸ åœ£è¯ç¥ç¦";
                popupText.innerText = hit[0].object.parent.userData.text;
                popup.classList.add("show");
            }
        });
        function closePopup() { popup.classList.remove("show"); }

        /* åŠ¨ç”» */
        function animate() {
            requestAnimationFrame(animate);

            tree.rotation.y += .002;

            const glow = (Math.sin(Date.now() * 0.003) + 1) / 2;
            star.material.emissiveIntensity = 1 + .8 * glow;
            star.scale.setScalar(1 + .05 * glow);

            const idx = Math.floor(Date.now() * 0.002) % lightColors.length;
            lights.forEach(l => {
                l.material.color.copy(lightColors[idx]);
                l.material.emissive.copy(lightColors[idx]);
            });

            const p = snowGeo.attributes.position.array;
            for (let i = 1; i < p.length; i += 3) {
                p[i] -= .05;
                if (p[i] < 0) p[i] = 60;
            }
            snowGeo.attributes.position.needsUpdate = true;

            renderer.render(scene, camera);
        }
        animate();

        window.addEventListener("resize", () => {
            camera.aspect = innerWidth / innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(innerWidth, innerHeight);
        });
    </script>
</body>

</html>